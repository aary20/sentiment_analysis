{% extends 'sentiment_app/base.html' %}
{% load static %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Data Visualization</h2>
            </div>
            <div class="card-body">
                <form id="visualization-form" method="post" action="{% url 'sentiment_app:visualize' %}">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="visualization_type" class="form-label">Visualization Type:</label>
                                <select class="form-select" id="visualization_type" name="visualization_type">
                                    <option value="wordcloud" {% if visualization_type == 'wordcloud' %}selected{% endif %}>Word Cloud</option>
                                    <option value="pie_chart" {% if visualization_type == 'pie_chart' %}selected{% endif %}>Pie Chart</option>
                                    <option value="label_analysis" {% if visualization_type == 'label_analysis' %}selected{% endif %}>Bar Chart</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="sentiment_filter" class="form-label">Sentiment Filter:</label>
                                <select class="form-select" id="sentiment_filter" name="sentiment_filter">
                                    <option value="total" {% if sentiment_filter == 'total' %}selected{% endif %}>Total</option>
                                    <option value="positive" {% if sentiment_filter == 'positive' %}selected{% endif %}>Positive</option>
                                    <option value="negative" {% if sentiment_filter == 'negative' %}selected{% endif %}>Negative</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4" id="variation-field">
                            <div class="mb-3">
                                <label for="variation" class="form-label">Variation (1-100):</label>
                                <input type="number" class="form-control" id="variation" name="variation" min="1" max="100" value="{{ variation|default:50 }}">
                                <div class="form-text">Higher values show more words</div>
                            </div>
                        </div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" id="visualize-btn" class="btn btn-primary">
                            <i class="fas fa-eye me-2"></i>Generate Visualization
                        </button>
                    </div>
                </form>

                {% if plot_url %}
                <div class="visualization-container mt-4">
                    <h3 class="mb-3 text-center">Visualization Results</h3>
                    <div class="text-center">
                        <img src="{{ plot_url }}" class="img-fluid rounded" alt="Visualization">
                        <div class="mt-3">
                            <a href="{{ plot_url }}" class="btn btn-outline-primary" download>
                                <i class="fas fa-download me-2"></i>Download Image
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if error %}
                <div class="error-box mt-4">
                    <h3 class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Error</h3>
                    <p>{{ error }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add a loading indicator when form is submitted
        const form = document.getElementById('visualization-form');
        form.addEventListener('submit', function() {
            showLoading('visualize-btn', 'Generating...');
        });
        
        // Add a range slider for variation
        const variationInput = document.getElementById('variation');
        const rangeSlider = document.createElement('input');
        rangeSlider.type = 'range';
        rangeSlider.className = 'form-range';
        rangeSlider.min = '1';
        rangeSlider.max = '100';
        rangeSlider.value = variationInput.value;
        
        variationInput.parentNode.insertBefore(rangeSlider, variationInput.nextSibling);
        
        // Sync the range slider with the number input
        rangeSlider.addEventListener('input', function() {
            variationInput.value = this.value;
        });
        
        variationInput.addEventListener('input', function() {
            rangeSlider.value = this.value;
        });
    });
</script>
{% endblock %}
